<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Résultats – Hauts de Flandre Natation</title>
  <meta name="description" content="Consultez les résultats des compétitions du club Hauts de Flandre Natation. Performances, classements et progression de nos nageurs dans les Hauts-de-France.">
  <meta name="keywords" content="résultats natation, compétitions, performances, Hauts de Flandre Natation, FFN, Wormhout, CCHF, natation sportive, championnats, temps, classement">
  <meta name="author" content="Hauts de Flandre Natation">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://hautsdeflandrenatation.fr/resultats.html">

  <!-- Open Graph -->
  <meta property="og:title" content="Résultats – Hauts de Flandre Natation">
  <meta property="og:description" content="Découvrez les performances de nos nageurs lors des compétitions FFN. Classements et temps officiels de Hauts de Flandre Natation.">
  <meta property="og:image" content="https://hautsdeflandrenatation.fr/images/logo_2025.png">
  <meta property="og:url" content="https://hautsdeflandrenatation.fr/resultats.html">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Résultats – Hauts de Flandre Natation">
  <meta name="twitter:description" content="Consultez les résultats et performances de nos nageurs. Tous les classements FFN disponibles sur le site officiel du club.">
  <meta name="twitter:image" content="https://hautsdeflandrenatation.fr/images/logo_2025.png">

  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="images/favicon.png">

  <style>
    /* ===========================
       TABLEAUX CSV
       =========================== */
    .csv-table {
      border-collapse: collapse;
      width: 100%;
      min-width: 600px;
      background-color: #f9f9f9;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .csv-table th, .csv-table td {
      border: 1px solid #ccc;
      padding: 12px 15px;
      text-align: center;
      white-space: nowrap;
    }

    .csv-table th {
      background-color: #0057b8;
      color: white;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    .csv-table tr:nth-child(even) {
      background-color: #e6f0fa;
    }

    .csv-table tr:hover {
      background-color: #d0e4ff;
    }

    h2 {
      text-align: center;
      margin-top: 2em;
    }

    select.colFilter {
      margin-top: 5px;
      width: 100%;
    }

    .best-record {
      background-color: gold !important;
      font-weight: bold;
    }

    .table-container {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 1.5em auto;
    }

    .table-container::-webkit-scrollbar {
      height: 6px;
    }
    .table-container::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 3px;
    }

    /* Bouton "Afficher plus" */
    .show-more-btn {
      display: block;
      margin: 15px auto;
      padding: 10px 18px;
      background-color: #0057b8;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .show-more-btn:hover {
      background-color: #003f82;
    }
  </style>
</head>

<body>
  <div id="bandeau"></div>
  <div id="header"></div>

  <main>
    <section class="intro-section">
      <h2>Résultats du club</h2>
      <p>
        Retrouvez ici les performances de nos nageurs, extraites des résultats officiels de la 
        <a href="https://www.ffnatation.fr" target="_blank" rel="noopener noreferrer">
          <strong>Fédération Française de Natation (FFN)</strong>
        </a>. 
      </p>
      <p>
        Ces données reflètent les compétitions auxquelles nos athlètes ont participé et illustrent leurs progrès tout au long de la saison.
      </p>
    </section>

    <h2>Records Féminins</h2>
    <div class="table-container">
      <div id="recordsFeminin">Chargement...</div>
    </div>

    <h2>Records Masculins</h2>
    <div class="table-container">
      <div id="recordsMasculin">Chargement...</div>
    </div>

    <h2>Tous les résultats</h2>
    <div class="table-container">
      <div id="tableContainer">Chargement des résultats...</div>
    </div>
  </main>

  <footer id="footer"></footer>

  <!-- GoatCounter -->
  <script data-goatcounter="https://clubhautsdeflandrenatation.goatcounter.com/count"
          async src="https://gc.zgo.at/count.js"></script>

  <!-- Chargement bandeau / header / footer -->
  <script>
    fetch('bandeau.html')
      .then(r => r.text())
      .then(data => {
        document.getElementById('bandeau').innerHTML = data;
        const scripts = document.getElementById('bandeau').getElementsByTagName('script');
        for (let s of scripts) {
          const newScript = document.createElement('script');
          if (s.src) newScript.src = s.src;
          else newScript.textContent = s.textContent;
          document.body.appendChild(newScript);
        }
      });

    fetch('header.html')
      .then(r => r.text())
      .then(data => document.getElementById('header').innerHTML = data);

    fetch('footer.html')
      .then(r => r.text())
      .then(data => document.getElementById('footer').innerHTML = data);
  </script>

  <!-- Script principal -->
  <script>
    function timeToSeconds(t) {
      if (!t) return Infinity;
      const parts = t.split(":").map(p => p.trim());
      if (parts.length === 1) return parseFloat(parts[0]) || Infinity;
      if (parts.length === 2) return parseInt(parts[0]) * 60 + parseFloat(parts[1]);
      return Infinity;
    }

    fetch('data/resultats_csv.csv')
      .then(r => r.text())
      .then(text => {
        const lines = text.replace(/\r/g,'').split('\n');
        const headers = lines[0].split(';').map(h => h.trim());
        const data = lines.slice(1).filter(l => l.trim() !== '').map(l => l.split(';').map(c => c.trim()));

        const colEpreuve = 0, colGenre = 1, colNom = 2, colTemps = 4, colCategorie = 7;
        const categorieOrder = ["Avenirs", "Benjamins", "Juniors", "Seniors",
                                "Master C1", "Master C2", "Master C3", "Master C4",
                                "Master C5", "Master C6", "Master C7", "Master C8"];

        function buildRecordsTable(genre, containerId) {
          const records = {};
          data.filter(row => row[colGenre] === genre).forEach(row => {
            const epreuve = row[colEpreuve];
            const cat = row[colCategorie];
            const nom = row[colNom];
            const temps = row[colTemps];
            const timeSec = timeToSeconds(temps);
            if (!records[epreuve]) records[epreuve] = {};
            if (!records[epreuve][cat] || timeSec < records[epreuve][cat].timeSec)
              records[epreuve][cat] = { temps, nom, timeSec };
          });

          if (Object.keys(records).length === 0) {
            document.getElementById(containerId).innerHTML = "<p>Aucun record trouvé.</p>";
            return;
          }

          const usedCategories = categorieOrder.filter(cat =>
            Object.values(records).some(e => e[cat])
          );

          let tableHTML = '<table class="csv-table"><thead><tr><th>Épreuve</th>';
          usedCategories.forEach(cat => tableHTML += `<th>${cat}</th>`);
          tableHTML += '</tr></thead><tbody>';

          Object.keys(records).forEach(epreuve => {
            tableHTML += `<tr><td>${epreuve}</td>`;
            usedCategories.forEach(cat => {
              if (records[epreuve][cat])
                tableHTML += `<td>${records[epreuve][cat].temps} (${records[epreuve][cat].nom})</td>`;
              else tableHTML += `<td></td>`;
            });
            tableHTML += '</tr>';
          });

          tableHTML += '</tbody></table>';
          document.getElementById(containerId).innerHTML = tableHTML;

          const rows = document.querySelectorAll(`#${containerId} tbody tr`);
          rows.forEach(row => {
            const cells = Array.from(row.querySelectorAll("td")).slice(1);
            let bestCell = null;
            let bestTime = Infinity;
            cells.forEach(cell => {
              const text = cell.textContent.trim();
              if (text) {
                const timeStr = text.split("(")[0].trim();
                const secs = timeToSeconds(timeStr);
                if (secs < bestTime) {
                  bestTime = secs;
                  bestCell = cell;
                }
              }
            });
            if (bestCell) bestCell.classList.add("best-record");
          });
        }

        buildRecordsTable("Feminin", "recordsFeminin");
        buildRecordsTable("Masculin", "recordsMasculin");

        // Tableau complet
        let tableHTML = '<table id="resultsTable" class="csv-table"><thead><tr>';
        headers.forEach((h, i) => {
          const uniqueValues = [...new Set(data.map(row => row[i]))].sort();
          let selectHTML = `<select class="colFilter" data-col="${i}"><option value="">Tous</option>`;
          uniqueValues.forEach(val => selectHTML += `<option value="${val}">${val}</option>`);
          selectHTML += '</select>';
          tableHTML += `<th>${h}<br>${selectHTML}</th>`;
        });
        tableHTML += '</tr></thead><tbody>';

        data.forEach(row => {
          tableHTML += '<tr>';
          row.forEach(cell => tableHTML += `<td>${cell}</td>`);
          tableHTML += '</tr>';
        });

        tableHTML += '</tbody></table>';
        document.getElementById('tableContainer').innerHTML = tableHTML;

        // Filtres
        const filters = document.querySelectorAll('.colFilter');
        filters.forEach(select => {
          select.addEventListener('change', () => {
            const rows = document.querySelectorAll('#resultsTable tbody tr');
            rows.forEach(row => {
              let show = true;
              filters.forEach(f => {
                const col = f.dataset.col;
                const val = f.value;
                if (val && row.cells[col].textContent !== val) show = false;
              });
              row.style.display = show ? '' : 'none';
            });
          });
        });

        // Limiter le tableau complet à 20 lignes visibles
        const table = document.querySelector("#resultsTable");
        if (table) {
          const rows = Array.from(table.querySelectorAll("tbody tr"));
          const maxVisible = 20;
          if (rows.length > maxVisible) {
            rows.slice(maxVisible).forEach(tr => tr.style.display = "none");
            const btn = document.createElement("button");
            btn.className = "show-more-btn";
            btn.textContent = "Afficher plus";
            btn.addEventListener("click", () => {
              const hidden = rows.filter(r => r.style.display === "none");
              hidden.slice(0, maxVisible).forEach(r => r.style.display = "");
              if (hidden.length <= maxVisible) btn.style.display = "none";
            });
            table.parentNode.appendChild(btn);
          }
        }
      })
      .catch(err => {
        console.error(err);
        document.getElementById('tableContainer').textContent = 'Erreur lors du chargement des résultats.';
      });
  </script>
</body>
</html>
